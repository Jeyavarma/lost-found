exports.id=864,exports.ids=[864],exports.modules={553:(a,b,c)=>{"use strict";c.d(b,{default:()=>p});var d=c(21124),e=c(38301),f=c(71179),g=c(88386),h=c(47089),i=c(19217),j=c(45119);c(50849);var k=c(22544),l=c(674),m=c(72966);function n({onSelectRoom:a,currentUserId:b}){let[c,g]=(0,e.useState)([]),[h,n]=(0,e.useState)(!0);return h?(0,d.jsxs)(j.Zp,{className:"h-full",children:[(0,d.jsx)(j.aR,{children:(0,d.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(f.A,{className:"w-5 h-5"}),"Messages"]})}),(0,d.jsx)(j.Wu,{children:(0,d.jsx)("div",{className:"flex justify-center py-8",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})]}):(0,d.jsxs)(j.Zp,{className:"h-full",children:[(0,d.jsx)(j.aR,{children:(0,d.jsxs)(j.ZB,{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(f.A,{className:"w-5 h-5"}),"Messages"]}),(0,d.jsx)(k.E,{variant:"secondary",children:c.length})]})}),(0,d.jsx)(j.Wu,{className:"p-0",children:0===c.length?(0,d.jsxs)("div",{className:"text-center py-8 px-4",children:[(0,d.jsx)(f.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,d.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"No conversations yet"}),(0,d.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:'Start a conversation by viewing an item and clicking "Contact"'})]}):(0,d.jsx)(m.F,{className:"h-96",children:(0,d.jsx)("div",{className:"space-y-1 p-2",children:c.map(c=>{let e=c.participants.find(a=>a.userId._id!==b);return(0,d.jsx)(i.$,{variant:"ghost",className:"w-full h-auto p-3 justify-start hover:bg-gray-50",onClick:()=>a(c),children:(0,d.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[c.itemId.imageUrl?(0,d.jsx)("img",{src:c.itemId.imageUrl,alt:c.itemId.title,className:"w-12 h-12 rounded-lg object-cover flex-shrink-0"}):(0,d.jsx)(l.eu,{className:"w-12 h-12 flex-shrink-0",children:(0,d.jsx)(l.q5,{children:c.itemId.title.charAt(0)})}),(0,d.jsxs)("div",{className:"flex-1 min-w-0 text-left",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,d.jsx)("h4",{className:"font-medium text-sm truncate",children:c.itemId.title}),c.lastMessage&&(0,d.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:(a=>{let b=new Date(a),c=(new Date().getTime()-b.getTime())/36e5;if(c<1){let a=Math.floor(60*c);return`${a}m ago`}{if(c<24)return`${Math.floor(c)}h ago`;let a=Math.floor(c/24);return`${a}d ago`}})(c.lastMessage.timestamp)})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,d.jsx)(k.E,{variant:"outline",className:"text-xs",children:c.itemId.category}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["with ",e?.userId.name]})]}),c.lastMessage&&(0,d.jsx)("p",{className:"text-xs text-gray-600 truncate",children:c.lastMessage.content})]})]})},c._id)})})})})]})}c(60637);var o=c(95907);function p(){let[a,b]=(0,e.useState)(!1),[c,k]=(0,e.useState)(!1),[l,m]=(0,e.useState)(null),[p,q]=(0,e.useState)(!1),[r,s]=(0,e.useState)("");return p?(0,d.jsxs)(d.Fragment,{children:[!a&&(0,d.jsx)(i.$,{onClick:()=>b(!0),className:"fixed bottom-6 right-6 w-14 h-14 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg z-50 p-0",children:(0,d.jsx)(f.A,{className:"w-6 h-6"})}),a&&(0,d.jsx)("div",{className:`fixed bottom-6 right-6 z-50 transition-all duration-300 ${c?"w-80 h-12":"w-80 h-96"}`,children:(0,d.jsxs)(j.Zp,{className:"h-full shadow-xl border-2",children:[(0,d.jsx)(j.aR,{className:"p-3 bg-blue-600 text-white rounded-t-lg",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)(j.ZB,{className:"text-sm font-medium",children:l?l.itemId.title:"Messages"}),(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>k(!c),className:"text-white hover:bg-blue-700 p-1 h-6 w-6",children:(0,d.jsx)(g.A,{className:"w-3 h-3"})}),(0,d.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>{b(!1),m(null),k(!1)},className:"text-white hover:bg-blue-700 p-1 h-6 w-6",children:(0,d.jsx)(h.A,{className:"w-3 h-3"})})]})]})}),!c&&(0,d.jsx)(j.Wu,{className:"p-0 h-full overflow-hidden",children:l?(0,d.jsx)(o.A,{room:l,currentUserId:r,onBack:()=>{m(null)}}):(0,d.jsx)(n,{onSelectRoom:a=>{m(a)},currentUserId:r})})]})})]}):null}},674:(a,b,c)=>{"use strict";c.d(b,{eu:()=>h,q5:()=>i});var d=c(21124),e=c(38301),f=c(33636),g=c(15514);let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.bL,{ref:c,className:(0,g.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...b}));h.displayName=f.bL.displayName,e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f._V,{ref:c,className:(0,g.cn)("aspect-square h-full w-full",a),...b})).displayName=f._V.displayName;let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.H4,{ref:c,className:(0,g.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...b}));i.displayName=f.H4.displayName},7629:(a,b,c)=>{"use strict";c.d(b,{p:()=>g});var d=c(21124),e=c(38301),f=c(15514);let g=e.forwardRef(({className:a,type:b,...c},e)=>(0,d.jsx)("input",{type:b,className:(0,f.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:e,...c}));g.displayName="Input"},15514:(a,b,c)=>{"use strict";c.d(b,{cn:()=>f});var d=c(43249),e=c(58829);function f(...a){return(0,e.QP)((0,d.$)(a))}},16953:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>k,metadata:()=>j});var d=c(75338),e=c(4986),f=c.n(e),g=c(68034),h=c.n(g),i=c(19455);c(82704);let j={title:"MCC Lost & Found",description:"Lost and Found system for MCC Campus",generator:"Next.js"};function k({children:a}){return(0,d.jsxs)("html",{lang:"en",children:[(0,d.jsx)("head",{children:(0,d.jsx)("style",{children:`
html {
  font-family: ${f().style.fontFamily};
  --font-sans: ${f().variable};
  --font-mono: ${h().variable};
}
        `})}),(0,d.jsxs)("body",{children:[a,(0,d.jsx)(i.default,{})]})]})}},19217:(a,b,c)=>{"use strict";c.d(b,{$:()=>j});var d=c(21124),e=c(38301),f=c(96425),g=c(26691),h=c(15514);let i=(0,g.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 !text-white",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 !text-white",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),j=e.forwardRef(({className:a,variant:b,size:c,asChild:e=!1,...g},j)=>{let k=e?f.DX:"button";return(0,d.jsx)(k,{className:(0,h.cn)(i({variant:b,size:c,className:a})),ref:j,...g})});j.displayName="Button"},19455:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/varma/projects/lost-found/components/floating-chat.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/varma/projects/lost-found/components/floating-chat.tsx","default")},22544:(a,b,c)=>{"use strict";c.d(b,{E:()=>h});var d=c(21124);c(38301);var e=c(26691),f=c(15514);let g=(0,e.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function h({className:a,variant:b,...c}){return(0,d.jsx)("div",{className:(0,f.cn)(g({variant:b}),a),...c})}},30213:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,81170,23)),Promise.resolve().then(c.t.bind(c,23597,23)),Promise.resolve().then(c.t.bind(c,36893,23)),Promise.resolve().then(c.t.bind(c,89748,23)),Promise.resolve().then(c.t.bind(c,6060,23)),Promise.resolve().then(c.t.bind(c,7184,23)),Promise.resolve().then(c.t.bind(c,69576,23)),Promise.resolve().then(c.t.bind(c,73041,23)),Promise.resolve().then(c.t.bind(c,51384,23))},39727:()=>{},43365:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,54160,23)),Promise.resolve().then(c.t.bind(c,31603,23)),Promise.resolve().then(c.t.bind(c,68495,23)),Promise.resolve().then(c.t.bind(c,75170,23)),Promise.resolve().then(c.t.bind(c,77526,23)),Promise.resolve().then(c.t.bind(c,78922,23)),Promise.resolve().then(c.t.bind(c,29234,23)),Promise.resolve().then(c.t.bind(c,12263,23)),Promise.resolve().then(c.bind(c,82146))},43567:(a,b,c)=>{"use strict";c.d(b,{b:()=>l});var d=c(66013),e=c(50849),f=c(60637);class g{constructor(){this.queue=[],this.STORAGE_KEY="chat_message_queue",this.MAX_RETRIES=3,this.loadFromStorage()}addMessage(a,b,c="text"){let d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,e={id:d,roomId:a,content:b,type:c,timestamp:Date.now(),status:"pending",retryCount:0};return this.queue.push(e),this.saveToStorage(),d}getPendingMessages(a){return this.queue.filter(b=>b.roomId===a&&("pending"===b.status||"sending"===b.status))}getAllPending(){return this.queue.filter(a=>"pending"===a.status||"sending"===a.status)}updateStatus(a,b){let c=this.queue.find(b=>b.id===a);c&&(c.status=b,this.saveToStorage())}markAsSent(a){this.queue=this.queue.filter(b=>b.id!==a),this.saveToStorage()}markAsFailed(a){let b=this.queue.find(b=>b.id===a);b&&(b.retryCount++,b.status=b.retryCount>=this.MAX_RETRIES?"failed":"pending",this.saveToStorage())}cleanup(){let a=Date.now()-864e5;this.queue=this.queue.filter(b=>!("failed"===b.status&&b.timestamp<a)),this.saveToStorage()}clearRoom(a){this.queue=this.queue.filter(b=>b.roomId!==a),this.saveToStorage()}saveToStorage(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.queue))}catch(a){console.error("Failed to save message queue:",a)}}loadFromStorage(){try{let a=localStorage.getItem(this.STORAGE_KEY);a&&(this.queue=JSON.parse(a),this.cleanup())}catch(a){console.error("Failed to load message queue:",a),this.queue=[]}}}let h=new g;class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}startHealthCheck(a){this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.healthCheckInterval=setInterval(()=>{a&&a.connected?(this.lastPingTime=Date.now(),a.emit("ping",this.lastPingTime),this.connectionStatus="connected"):(this.connectionStatus="disconnected",console.warn("Chat connection lost, attempting reconnect..."))},3e4)}stopHealthCheck(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null)}getConnectionStatus(){return{status:this.connectionStatus,lastPing:this.lastPingTime,isHealthy:"connected"===this.connectionStatus&&Date.now()-this.lastPingTime<6e4}}constructor(){this.healthCheckInterval=null,this.lastPingTime=0,this.connectionStatus="disconnected"}}let j=i.getInstance();class k{connect(){if(this.socket?.connected)return this.socket;let a=(0,e.getAuthToken)();if(!a)return console.warn("No auth token found, cannot connect to chat"),null;try{let b={auth:{token:a},transports:["websocket","polling"],timeout:2e4,forceNew:!0,withCredentials:!0,upgrade:!0,rememberUpgrade:!0};return b.secure=!0,b.rejectUnauthorized=!1,this.socket=(0,d.io)(f.f,b),this.socket.on("connect",()=>{console.log("Connected to chat server at:",f.f),this.reconnectAttempts=0,this.processQueuedMessages(),j.startHealthCheck(this.socket)}),this.socket.on("pong",a=>{let b=Date.now()-a;console.log(`Chat server latency: ${b}ms`)}),this.socket.on("message_delivered",a=>{let b=this.messageCallbacks.get(a.messageId);b&&(b("sent"),this.messageCallbacks.delete(a.messageId)),h.markAsSent(a.messageId)}),this.socket.on("message_failed",a=>{let b=this.messageCallbacks.get(a.messageId);b&&(b("failed"),this.messageCallbacks.delete(a.messageId)),h.markAsFailed(a.messageId)}),this.socket.on("disconnect",a=>{console.log("Disconnected from chat server:",a),j.stopHealthCheck()}),this.socket.on("connect_error",a=>{console.error("Chat connection error:",a),this.handleReconnect()}),this.socket}catch(a){return console.error("Failed to create socket connection:",a),null}}handleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,setTimeout(()=>{console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.connect()},1e3*this.reconnectAttempts))}disconnect(){this.socket&&(j.stopHealthCheck(),this.socket.disconnect(),this.socket=null)}getHealthStatus(){return j.getConnectionStatus()}getSocket(){return this.socket}isConnected(){return this.socket?.connected||!1}sendMessage(a,b,c="text",d){let e=h.addMessage(a,b,c);return d&&this.messageCallbacks.set(e,d),this.isConnected()&&this.sendQueuedMessage({id:e,roomId:a,content:b,type:c,timestamp:Date.now(),status:"pending",retryCount:0}),e}async processQueuedMessages(){if(!this.processingQueue&&this.isConnected()){for(let a of(this.processingQueue=!0,h.getAllPending()))await this.sendQueuedMessage(a),await new Promise(a=>setTimeout(a,100));this.processingQueue=!1}}sendQueuedMessage(a){this.socket&&this.isConnected()&&(h.updateStatus(a.id,"sending"),this.socket.emit("send_message",{messageId:a.id,roomId:a.roomId,content:a.content,type:a.type}))}getPendingMessages(a){return h.getPendingMessages(a)}clearMessageQueue(a){h.clearRoom(a)}constructor(){this.socket=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.messageCallbacks=new Map,this.processingQueue=!1}}let l=new k},45119:(a,b,c)=>{"use strict";c.d(b,{BT:()=>j,Wu:()=>k,ZB:()=>i,Zp:()=>g,aR:()=>h});var d=c(21124),e=c(38301),f=c(15514);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...b}));g.displayName="Card";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex flex-col space-y-1.5 p-6",a),...b}));h.displayName="CardHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));i.displayName="CardTitle";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("text-sm text-muted-foreground",a),...b}));j.displayName="CardDescription";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("p-6 pt-0",a),...b}));k.displayName="CardContent",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex items-center p-6 pt-0",a),...b})).displayName="CardFooter"},47990:()=>{},50849:(a,b,c)=>{"use strict";function d(){return null}function e(a){}function f(){return null}function g(a){}async function h(a){try{return(await fetch("https://lost-found-79xn.onrender.com/api/auth/validate",{method:"GET",headers:{Authorization:`Bearer ${a}`}})).ok}catch{return!1}}function i(){return!!d()}function j(){window.location.href="/"}c.d(b,{gL:()=>f,getAuthToken:()=>d,isAuthenticated:()=>i,logout:()=>j,setAuthToken:()=>e,setUserData:()=>g,validateToken:()=>h})},56165:(a,b,c)=>{Promise.resolve().then(c.bind(c,19455))},58475:(a,b,c)=>{"use strict";c.d(b,{E$:()=>d,tk:()=>f});let d=(0,c(18610).vt)((a,b)=>({notifications:[],unreadCount:0,addNotification:b=>{let c={...b,id:Date.now().toString(),read:!1,createdAt:new Date};a(a=>({notifications:[c,...a.notifications],unreadCount:a.unreadCount+1}))},markAsRead:b=>{a(a=>({notifications:a.notifications.map(a=>a.id===b?{...a,read:!0}:a),unreadCount:Math.max(0,a.unreadCount-1)}))},markAllAsRead:()=>{a(a=>({notifications:a.notifications.map(a=>({...a,read:!0})),unreadCount:0}))},removeNotification:b=>{a(a=>{let c=a.notifications.find(a=>a.id===b);return{notifications:a.notifications.filter(a=>a.id!==b),unreadCount:c&&!c.read?Math.max(0,a.unreadCount-1):a.unreadCount}})},clearAll:()=>{a({notifications:[],unreadCount:0})}})),e={newMessage:(a,b,c)=>{d.getState().addNotification({type:"message",title:"\uD83D\uDCAC New Message",message:`${a} sent you a message about "${b}"`,itemId:c,itemTitle:b})}},f={initialize:()=>{},showChatNotification:(a,b,c,d)=>{e.newMessage(a,d,c)}}},60637:(a,b,c)=>{"use strict";c.d(b,{f:()=>d});let d="https://lost-found-79xn.onrender.com"},69317:(a,b,c)=>{Promise.resolve().then(c.bind(c,553))},72966:(a,b,c)=>{"use strict";c.d(b,{F:()=>h});var d=c(21124),e=c(38301),f=c(84550),g=c(15514);let h=e.forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(f.bL,{ref:e,className:(0,g.cn)("relative overflow-hidden",a),...c,children:[(0,d.jsx)(f.LM,{className:"h-full w-full rounded-[inherit]",children:b}),(0,d.jsx)(i,{}),(0,d.jsx)(f.OK,{})]}));h.displayName=f.bL.displayName;let i=e.forwardRef(({className:a,orientation:b="vertical",...c},e)=>(0,d.jsx)(f.VM,{ref:e,orientation:b,className:(0,g.cn)("flex touch-none select-none transition-colors","vertical"===b&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===b&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...c,children:(0,d.jsx)(f.lr,{className:"relative flex-1 rounded-full bg-border"})}));i.displayName=f.VM.displayName},78335:()=>{},82704:()=>{},90391:(a,b,c)=>{"use strict";function d(){return null}c.r(b),c.d(b,{default:()=>d})},95907:(a,b,c)=>{"use strict";c.d(b,{A:()=>s});var d=c(21124),e=c(38301),f=c(45119),g=c(19217),h=c(7629),i=c(72966),j=c(22544),k=c(674),l=c(79944),m=c(56955),n=c(47089),o=c(71563),p=c(43567),q=c(60637),r=c(50849);function s({room:a,onClose:b,onBack:c,currentUserId:s}){let[t,u]=(0,e.useState)([]),[v,w]=(0,e.useState)([]),[x,y]=(0,e.useState)(""),[z,A]=(0,e.useState)(!0),[B,C]=(0,e.useState)(!1),[D,E]=(0,e.useState)(navigator.onLine),F=(0,e.useRef)(null);p.b.getSocket();let G=a.participants.find(a=>a.userId._id!==s),H=async()=>{if(x.trim()&&!B){C(!0);try{let b={id:p.b.sendMessage(a._id,x.trim(),"text",b=>{"failed"===b&&w(p.b.getPendingMessages(a._id))}),roomId:a._id,content:x.trim(),type:"text",timestamp:Date.now(),status:"pending",retryCount:0};w(a=>[...a,b]),y("")}catch(a){console.error("Failed to send message:",a)}finally{C(!1)}}},I=async()=>{if(G)try{let a=(0,r.getAuthToken)();(await fetch(`${q.f}/api/chat/block/${G.userId._id}`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({reason:"Blocked from chat"})})).ok&&(alert("User blocked successfully"),b?.())}catch(a){console.error("Block user error:",a)}},J=a=>a.readBy?.some(a=>a.userId!==s)||!1;return(0,d.jsxs)(f.Zp,{className:"h-full flex flex-col",children:[(0,d.jsx)(f.aR,{className:"pb-3 border-b",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(g.$,{variant:"ghost",size:"sm",onClick:c||b,children:(0,d.jsx)(l.A,{className:"w-4 h-4"})}),a.itemId.imageUrl&&(0,d.jsx)("img",{src:a.itemId.imageUrl,alt:a.itemId.title,className:"w-10 h-10 rounded-lg object-cover"}),(0,d.jsxs)("div",{children:[(0,d.jsx)(f.ZB,{className:"text-lg",children:a.itemId.title}),(0,d.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,d.jsx)(j.E,{variant:"outline",children:a.itemId.category}),(0,d.jsx)("span",{children:"•"}),(0,d.jsxs)("span",{children:["with ",G?.userId.name]})]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(g.$,{variant:"ghost",size:"sm",onClick:I,title:"Block User",children:(0,d.jsx)(m.A,{className:"w-4 h-4"})}),b&&(0,d.jsx)(g.$,{variant:"ghost",size:"sm",onClick:b,children:(0,d.jsx)(n.A,{className:"w-4 h-4"})})]})]})}),(0,d.jsxs)(f.Wu,{className:"flex-1 p-0",children:[(0,d.jsx)(i.F,{className:"h-96 p-4",children:z?(0,d.jsx)("div",{className:"flex justify-center py-8",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):(0,d.jsxs)("div",{className:"space-y-4",children:[t.map(a=>{let b=a.senderId._id===s;return(0,d.jsx)("div",{className:`flex ${b?"justify-end":"justify-start"}`,children:(0,d.jsxs)("div",{className:`flex items-start gap-2 max-w-[70%] ${b?"flex-row-reverse":""}`,children:[!b&&(0,d.jsx)(k.eu,{className:"w-8 h-8",children:(0,d.jsx)(k.q5,{className:"text-xs",children:a.senderId.name.charAt(0)})}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:`rounded-lg px-3 py-2 ${b?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[(0,d.jsx)("p",{className:"text-sm",children:a.content}),(0,d.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,d.jsx)("p",{className:`text-xs ${b?"text-blue-100":"text-gray-500"}`,children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),b&&(0,d.jsx)("span",{className:`text-xs ${J(a)?"text-blue-200":"text-blue-300"}`,children:J(a)?"✓✓":"✓"})]})]}),a.reactions&&a.reactions.length>0&&(0,d.jsx)("div",{className:"flex gap-1 mt-1",children:a.reactions.map((a,b)=>(0,d.jsx)("span",{className:"text-xs bg-gray-100 px-1 rounded",children:a.emoji},b))})]})]})},a._id)}),v.map(a=>(0,d.jsx)("div",{className:"flex justify-end",children:(0,d.jsx)("div",{className:"flex items-start gap-2 max-w-[70%] flex-row-reverse",children:(0,d.jsxs)("div",{className:"bg-blue-400 text-white rounded-lg px-3 py-2 opacity-70",children:[(0,d.jsx)("p",{className:"text-sm",children:a.content}),(0,d.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,d.jsx)("p",{className:"text-xs text-blue-100",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,d.jsxs)("span",{className:"text-xs text-blue-200",children:["pending"===a.status&&"⏳","sending"===a.status&&"\uD83D\uDCE4","failed"===a.status&&"❌"]})]})]})})},a.id)),(0,d.jsx)("div",{ref:F})]})}),(0,d.jsxs)("div",{className:"border-t p-4",children:[!D&&(0,d.jsx)("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:"\uD83D\uDCE1 You're offline. Messages will be sent when connection is restored."}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(h.p,{placeholder:D?"Type a message...":"Type a message (will send when online)...",value:x,onChange:a=>y(a.target.value),onKeyPress:a=>"Enter"===a.key&&H(),disabled:B,className:"flex-1"}),(0,d.jsx)(g.$,{onClick:H,disabled:!x.trim()||B,size:"sm",children:B?(0,d.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,d.jsx)(o.A,{className:"w-4 h-4"})})]})]})]})]})}c(58475)},96487:()=>{}};