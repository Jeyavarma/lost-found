(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177,8209],{373:(e,t,a)=>{"use strict";a.d(t,{f:()=>r});let r="https://lost-found-79xn.onrender.com"},1103:(e,t,a)=>{"use strict";a.d(t,{default:()=>v});var r=a(5155),s=a(2115),n=a(5937),i=a(7624),o=a(5229),l=a(7003),c=a(3209),d=a(8209),u=a(7812),f=a(3884),h=a(7346),m=a(373);function g(e){let{onSelectRoom:t,currentUserId:a}=e,[i,o]=(0,s.useState)([]),[g,x]=(0,s.useState)(!0);(0,s.useEffect)(()=>{v()},[]);let v=async()=>{try{let e=(0,d.getAuthToken)(),t=await fetch("".concat(m.f,"/api/chat/rooms"),{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();o(e)}}catch(e){console.error("Failed to load chat rooms:",e)}finally{x(!1)}};return g?(0,r.jsxs)(c.Zp,{className:"h-full",children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)(c.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(n.A,{className:"w-5 h-5"}),"Messages"]})}),(0,r.jsx)(c.Wu,{children:(0,r.jsx)("div",{className:"flex justify-center py-8",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})]}):(0,r.jsxs)(c.Zp,{className:"h-full",children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)(c.ZB,{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(n.A,{className:"w-5 h-5"}),"Messages"]}),(0,r.jsx)(u.E,{variant:"secondary",children:i.length})]})}),(0,r.jsx)(c.Wu,{className:"p-0",children:0===i.length?(0,r.jsxs)("div",{className:"text-center py-8 px-4",children:[(0,r.jsx)(n.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"No conversations yet"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:'Start a conversation by viewing an item and clicking "Contact"'})]}):(0,r.jsx)(h.F,{className:"h-96",children:(0,r.jsx)("div",{className:"space-y-1 p-2",children:i.map(e=>{let s=e.participants.find(e=>e.userId._id!==a);return(0,r.jsx)(l.$,{variant:"ghost",className:"w-full h-auto p-3 justify-start hover:bg-gray-50",onClick:()=>t(e),children:(0,r.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[e.itemId.imageUrl?(0,r.jsx)("img",{src:e.itemId.imageUrl,alt:e.itemId.title,className:"w-12 h-12 rounded-lg object-cover flex-shrink-0"}):(0,r.jsx)(f.eu,{className:"w-12 h-12 flex-shrink-0",children:(0,r.jsx)(f.q5,{children:e.itemId.title.charAt(0)})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("h4",{className:"font-medium text-sm truncate",children:e.itemId.title}),e.lastMessage&&(0,r.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:(e=>{let t=new Date(e),a=(new Date().getTime()-t.getTime())/36e5;if(a<1){let e=Math.floor(60*a);return"".concat(e,"m ago")}{if(a<24)return"".concat(Math.floor(a),"h ago");let e=Math.floor(a/24);return"".concat(e,"d ago")}})(e.lastMessage.timestamp)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)(u.E,{variant:"outline",className:"text-xs",children:e.itemId.category}),(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["with ",null==s?void 0:s.userId.name]})]}),e.lastMessage&&(0,r.jsx)("p",{className:"text-xs text-gray-600 truncate",children:e.lastMessage.content})]})]})},e._id)})})})})]})}var x=a(3637);function v(){let[e,t]=(0,s.useState)(!1),[a,u]=(0,s.useState)(!1),[f,h]=(0,s.useState)(null),[m,v]=(0,s.useState)(!1),[b,p]=(0,s.useState)("");return((0,s.useEffect)(()=>{let e=(0,d.isAuthenticated)();if(v(e),e){let e=(0,d.gL)();p((null==e?void 0:e.id)||"")}},[]),m)?(0,r.jsxs)(r.Fragment,{children:[!e&&(0,r.jsx)(l.$,{onClick:()=>t(!0),className:"fixed bottom-6 right-6 w-14 h-14 rounded-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg z-50 p-0",children:(0,r.jsx)(n.A,{className:"w-6 h-6"})}),e&&(0,r.jsx)("div",{className:"fixed bottom-6 right-6 z-50 transition-all duration-300 ".concat(a?"w-80 h-12":"w-80 h-96"),children:(0,r.jsxs)(c.Zp,{className:"h-full shadow-xl border-2",children:[(0,r.jsx)(c.aR,{className:"p-3 bg-blue-600 text-white rounded-t-lg",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(c.ZB,{className:"text-sm font-medium",children:f?f.itemId.title:"Messages"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>u(!a),className:"text-white hover:bg-blue-700 p-1 h-6 w-6",children:(0,r.jsx)(i.A,{className:"w-3 h-3"})}),(0,r.jsx)(l.$,{variant:"ghost",size:"sm",onClick:()=>{t(!1),h(null),u(!1)},className:"text-white hover:bg-blue-700 p-1 h-6 w-6",children:(0,r.jsx)(o.A,{className:"w-3 h-3"})})]})]})}),!a&&(0,r.jsx)(c.Wu,{className:"p-0 h-full overflow-hidden",children:f?(0,r.jsx)(x.A,{room:f,currentUserId:b,onBack:()=>{h(null)}}):(0,r.jsx)(g,{onSelectRoom:e=>{h(e)},currentUserId:b})})]})})]}):null}},1233:(e,t,a)=>{"use strict";a.d(t,{E$:()=>r,tk:()=>n});let r=(0,a(5988).vt)((e,t)=>({notifications:[],unreadCount:0,addNotification:t=>{let a={...t,id:Date.now().toString(),read:!1,createdAt:new Date};e(e=>({notifications:[a,...e.notifications],unreadCount:e.unreadCount+1}))},markAsRead:t=>{e(e=>({notifications:e.notifications.map(e=>e.id===t?{...e,read:!0}:e),unreadCount:Math.max(0,e.unreadCount-1)}))},markAllAsRead:()=>{e(e=>({notifications:e.notifications.map(e=>({...e,read:!0})),unreadCount:0}))},removeNotification:t=>{e(e=>{let a=e.notifications.find(e=>e.id===t);return{notifications:e.notifications.filter(e=>e.id!==t),unreadCount:a&&!a.read?Math.max(0,e.unreadCount-1):e.unreadCount}})},clearAll:()=>{e({notifications:[],unreadCount:0})}})),s={newMessage:(e,t,a)=>{r.getState().addNotification({type:"message",title:"\uD83D\uDCAC New Message",message:"".concat(e,' sent you a message about "').concat(t,'"'),itemId:a,itemTitle:t})}},n={initialize:()=>{},showChatNotification:(e,t,a,r)=>{s.newMessage(e,r,a)}}},1290:()=>{},3209:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>i,aR:()=>o});var r=a(5155),s=a(2115),n=a(5016);let i=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...s})});i.displayName="Card";let o=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...s})});o.displayName="CardHeader";let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...s})});l.displayName="CardTitle";let c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...s})});c.displayName="CardDescription";let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...s})});d.displayName="CardContent",s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...s})}).displayName="CardFooter"},5016:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var r=a(2821),s=a(5889);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},6170:(e,t,a)=>{"use strict";a.d(t,{p:()=>i});var r=a(5155),s=a(2115),n=a(5016);let i=s.forwardRef((e,t)=>{let{className:a,type:s,...i}=e;return(0,r.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:t,...i})});i.displayName="Input"},6287:(e,t,a)=>{Promise.resolve().then(a.bind(a,1103)),Promise.resolve().then(a.bind(a,6957)),Promise.resolve().then(a.t.bind(a,2311,23)),Promise.resolve().then(a.t.bind(a,7183,23)),Promise.resolve().then(a.t.bind(a,1290,23))},6957:(e,t,a)=>{"use strict";a.d(t,{default:()=>c});var r=a(5155),s=a(2115),n=a(373),i=a(8209);class o{initialize(){this.startHeartbeat(),this.trackActivity(),document.addEventListener("visibilitychange",()=>{document.hidden?this.setOffline():(this.setOnline(),this.startHeartbeat())}),window.addEventListener("beforeunload",()=>{this.setOffline()})}startHeartbeat(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval(()=>{this.isActive&&this.sendHeartbeat()},6e4)}async sendHeartbeat(){try{let e=(0,i.getAuthToken)();if(!e)return;let t=/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)?"mobile":"desktop";await fetch("".concat(n.f,"/api/presence/heartbeat"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({deviceType:t})})}catch(e){console.error("Heartbeat failed:",e)}}async setOffline(){try{let e=(0,i.getAuthToken)();if(!e)return;await fetch("".concat(n.f,"/api/presence/offline"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}})}catch(e){console.error("Set offline failed:",e)}}setOnline(){this.isActive=!0,this.sendHeartbeat()}trackActivity(){let e,t=()=>{this.isActive=!0,clearTimeout(e),e=setTimeout(()=>{this.isActive=!1},3e5)};["mousedown","mousemove","keypress","scroll","touchstart"].forEach(e=>{document.addEventListener(e,t,!0)}),t()}destroy(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.setOffline()}constructor(){this.heartbeatInterval=null,this.isActive=!0}}let l=new o;function c(e){let{children:t}=e;return(0,s.useEffect)(()=>((0,i.isAuthenticated)()&&l.initialize(),()=>{l.destroy()}),[]),(0,r.jsx)(r.Fragment,{children:t})}},7003:(e,t,a)=>{"use strict";a.d(t,{$:()=>c});var r=a(5155),s=a(2115),n=a(2467),i=a(3101),o=a(5016);let l=(0,i.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 !text-white",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 !text-white",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:a,variant:s,size:i,asChild:c=!1,...d}=e,u=c?n.DX:"button";return(0,r.jsx)(u,{className:(0,o.cn)(l({variant:s,size:i,className:a})),ref:t,...d})});c.displayName="Button"},7812:(e,t,a)=>{"use strict";a.d(t,{E:()=>o});var r=a(5155);a(2115);var s=a(3101),n=a(5016);let i=(0,s.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)(i({variant:a}),t),...s})}},8209:(e,t,a)=>{"use strict";a.d(t,{gL:()=>o,getAuthToken:()=>n,isAuthenticated:()=>d,logout:()=>u,setAuthToken:()=>i,setUserData:()=>l,validateToken:()=>c});let r="authToken",s="userData";function n(){return localStorage.getItem(r)}function i(e){localStorage.setItem(r,e)}function o(){let e=localStorage.getItem(s);return e?JSON.parse(e):null}function l(e){let t={id:String(e.id).replace(/[<>"'&]/g,""),name:String(e.name).replace(/[<>"'&]/g,""),email:String(e.email).replace(/[<>"'&]/g,""),role:e.role};localStorage.setItem(s,JSON.stringify(t))}async function c(e){try{return(await fetch("".concat("https://lost-found-79xn.onrender.com","/api/auth/validate"),{method:"GET",headers:{Authorization:"Bearer ".concat(e)}})).ok}catch(e){return!1}}function d(){return!!n()}function u(){localStorage.removeItem(r),localStorage.removeItem(s),localStorage.removeItem("userType"),localStorage.removeItem("userName"),localStorage.removeItem("token"),window.location.href="/"}}},e=>{e.O(0,[5373,1741,5707,5769,4130,4195,3637,8441,1255,7358],()=>e(e.s=6287)),_N_E=e.O()}]);