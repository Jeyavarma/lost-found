exports.id=288,exports.ids=[288],exports.modules={674:(a,b,c)=>{"use strict";c.d(b,{eu:()=>h,q5:()=>i});var d=c(21124),e=c(38301),f=c(33636),g=c(15514);let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.bL,{ref:c,className:(0,g.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...b}));h.displayName=f.bL.displayName,e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f._V,{ref:c,className:(0,g.cn)("aspect-square h-full w-full",a),...b})).displayName=f._V.displayName;let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)(f.H4,{ref:c,className:(0,g.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...b}));i.displayName=f.H4.displayName},6554:(a,b,c)=>{"use strict";c.d(b,{default:()=>h});var d=c(21124);c(38301);var e=c(60637),f=c(50849);class g{initialize(){}startHeartbeat(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.heartbeatInterval=setInterval(()=>{this.isActive&&this.sendHeartbeat()},6e4)}async sendHeartbeat(){try{let a=(0,f.getAuthToken)();if(!a)return;let b=/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)?"mobile":"desktop";await fetch(`${e.f}/api/presence/heartbeat`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({deviceType:b})})}catch(a){console.error("Heartbeat failed:",a)}}async setOffline(){try{let a=(0,f.getAuthToken)();if(!a)return;await fetch(`${e.f}/api/presence/offline`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`}})}catch(a){console.error("Set offline failed:",a)}}setOnline(){this.isActive=!0,this.sendHeartbeat()}trackActivity(){let a,b=()=>{this.isActive=!0,clearTimeout(a),a=setTimeout(()=>{this.isActive=!1},3e5)};["mousedown","mousemove","keypress","scroll","touchstart"].forEach(a=>{document.addEventListener(a,b,!0)}),b()}destroy(){this.heartbeatInterval&&clearInterval(this.heartbeatInterval),this.setOffline()}constructor(){this.heartbeatInterval=null,this.isActive=!0}}function h({children:a}){return(0,d.jsx)(d.Fragment,{children:a})}new g},7629:(a,b,c)=>{"use strict";c.d(b,{p:()=>g});var d=c(21124),e=c(38301),f=c(15514);let g=e.forwardRef(({className:a,type:b,...c},e)=>(0,d.jsx)("input",{type:b,className:(0,f.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:e,...c}));g.displayName="Input"},15514:(a,b,c)=>{"use strict";c.d(b,{cn:()=>f});var d=c(43249),e=c(58829);function f(...a){return(0,e.QP)((0,d.$)(a))}},16706:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,81170,23)),Promise.resolve().then(c.t.bind(c,23597,23)),Promise.resolve().then(c.t.bind(c,36893,23)),Promise.resolve().then(c.t.bind(c,89748,23)),Promise.resolve().then(c.t.bind(c,6060,23)),Promise.resolve().then(c.t.bind(c,7184,23)),Promise.resolve().then(c.t.bind(c,69576,23)),Promise.resolve().then(c.t.bind(c,73041,23)),Promise.resolve().then(c.t.bind(c,51384,23))},16953:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>l,metadata:()=>k});var d=c(75338),e=c(4986),f=c.n(e),g=c(68034),h=c.n(g),i=c(96850),j=c(86605);c(82704);let k={title:"MCC Lost & Found",description:"Lost and Found system for MCC Campus",generator:"Next.js"};function l({children:a}){return(0,d.jsxs)("html",{lang:"en",children:[(0,d.jsx)("head",{children:(0,d.jsx)("style",{children:`
html {
  font-family: ${f().style.fontFamily};
  --font-sans: ${f().variable};
  --font-mono: ${h().variable};
}
        `})}),(0,d.jsx)("body",{children:(0,d.jsxs)(j.default,{children:[a,(0,d.jsx)(i.default,{})]})})]})}},19217:(a,b,c)=>{"use strict";c.d(b,{$:()=>j});var d=c(21124),e=c(38301),f=c(96425),g=c(26691),h=c(15514);let i=(0,g.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 !text-white",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 !text-white",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),j=e.forwardRef(({className:a,variant:b,size:c,asChild:e=!1,...g},j)=>{let k=e?f.DX:"button";return(0,d.jsx)(k,{className:(0,h.cn)(i({variant:b,size:c,className:a})),ref:j,...g})});j.displayName="Button"},22544:(a,b,c)=>{"use strict";c.d(b,{E:()=>h});var d=c(21124);c(38301);var e=c(26691),f=c(15514);let g=(0,e.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function h({className:a,variant:b,...c}){return(0,d.jsx)("div",{className:(0,f.cn)(g({variant:b}),a),...c})}},23167:(a,b,c)=>{"use strict";c.d(b,{A:()=>l});var d=c(21124),e=c(38301),f=c(45119),g=c(19217),h=c(22544),i=c(674),j=c(72966),k=c(71179);function l({onSelectRoom:a,currentUserId:b}){let[c,l]=(0,e.useState)([]),[m,n]=(0,e.useState)(!0);return m?(0,d.jsxs)(f.Zp,{className:"h-full",children:[(0,d.jsx)(f.aR,{children:(0,d.jsxs)(f.ZB,{className:"flex items-center gap-2",children:[(0,d.jsx)(k.A,{className:"w-5 h-5"}),"Messages"]})}),(0,d.jsx)(f.Wu,{children:(0,d.jsx)("div",{className:"flex justify-center py-8",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})]}):(0,d.jsxs)(f.Zp,{className:"h-full",children:[(0,d.jsx)(f.aR,{children:(0,d.jsxs)(f.ZB,{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(k.A,{className:"w-5 h-5"}),"Messages"]}),(0,d.jsx)(h.E,{variant:"secondary",children:c.length})]})}),(0,d.jsx)(f.Wu,{className:"p-0",children:0===c.length?(0,d.jsxs)("div",{className:"text-center py-8 px-4",children:[(0,d.jsx)(k.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,d.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"No conversations yet"}),(0,d.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:'Start a conversation by viewing an item and clicking "Contact"'})]}):(0,d.jsx)(j.F,{className:"h-96",children:(0,d.jsx)("div",{className:"space-y-1 p-2",children:c.filter(a=>a&&a._id).map(c=>{let e=c.participants.find(a=>a.userId._id!==b);return(0,d.jsx)(g.$,{variant:"ghost",className:"w-full h-auto p-3 justify-start hover:bg-gray-50",onClick:()=>a(c),children:(0,d.jsxs)("div",{className:"flex items-center gap-3 w-full",children:[c.itemId?.imageUrl?(0,d.jsx)("img",{src:c.itemId.imageUrl,alt:c.itemId?.title||"Item",className:"w-12 h-12 rounded-lg object-cover flex-shrink-0",onError:a=>{a.currentTarget.style.display="none"}}):(0,d.jsx)(i.eu,{className:"w-12 h-12 flex-shrink-0",children:(0,d.jsx)(i.q5,{children:c.itemId?.title?.charAt(0)||"C"})}),(0,d.jsxs)("div",{className:"flex-1 min-w-0 text-left",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,d.jsx)("h4",{className:"font-medium text-sm truncate",children:c.itemId?.title||"Direct Chat"}),c.lastMessage&&(0,d.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:(a=>{let b=new Date(a),c=(new Date().getTime()-b.getTime())/36e5;if(c<1){let a=Math.floor(60*c);return`${a}m ago`}{if(c<24)return`${Math.floor(c)}h ago`;let a=Math.floor(c/24);return`${a}d ago`}})(c.lastMessage.timestamp)})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[c.itemId?.category&&(0,d.jsx)(h.E,{variant:"outline",className:"text-xs",children:c.itemId.category}),(0,d.jsxs)("span",{className:"text-xs text-gray-500",children:["with ",e?.userId?.name||"User"]})]}),c.lastMessage&&(0,d.jsx)("p",{className:"text-xs text-gray-600 truncate",children:c.lastMessage.content})]})]})},c._id)})})})})]})}c(60637),c(50849)},26519:(a,b,c)=>{"use strict";c.d(b,{Fc:()=>i,TN:()=>j});var d=c(21124),e=c(38301),f=c(26691),g=c(15514);let h=(0,f.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=e.forwardRef(({className:a,variant:b,...c},e)=>(0,d.jsx)("div",{ref:e,role:"alert",className:(0,g.cn)(h({variant:b}),a),...c}));i.displayName="Alert",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("h5",{ref:c,className:(0,g.cn)("mb-1 font-medium leading-none tracking-tight",a),...b})).displayName="AlertTitle";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,g.cn)("text-sm [&_p]:leading-relaxed",a),...b}));j.displayName="AlertDescription"},34858:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,54160,23)),Promise.resolve().then(c.t.bind(c,31603,23)),Promise.resolve().then(c.t.bind(c,68495,23)),Promise.resolve().then(c.t.bind(c,75170,23)),Promise.resolve().then(c.t.bind(c,77526,23)),Promise.resolve().then(c.t.bind(c,78922,23)),Promise.resolve().then(c.t.bind(c,29234,23)),Promise.resolve().then(c.t.bind(c,12263,23)),Promise.resolve().then(c.bind(c,82146))},36736:(a,b,c)=>{"use strict";c.d(b,{Bc:()=>h,ZI:()=>k,k$:()=>j,m_:()=>i});var d=c(21124),e=c(38301),f=c(16992),g=c(15514);let h=f.Kq,i=f.bL,j=f.l9,k=e.forwardRef(({className:a,sideOffset:b=4,...c},e)=>(0,d.jsx)(f.UC,{ref:e,sideOffset:b,className:(0,g.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...c}));k.displayName=f.UC.displayName},39727:()=>{},43567:(a,b,c)=>{"use strict";c.d(b,{b:()=>l});var d=c(66013),e=c(50849),f=c(60637);class g{constructor(){this.queue=[],this.STORAGE_KEY="chat_message_queue",this.MAX_RETRIES=3,this.initialized=!1}ensureInitialized(){this.initialized}addMessage(a,b,c="text"){this.ensureInitialized();let d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,e={id:d,roomId:a,content:b,type:c,timestamp:Date.now(),status:"pending",retryCount:0};return this.queue.push(e),this.saveToStorage(),d}getPendingMessages(a){return this.ensureInitialized(),this.queue.filter(b=>b.roomId===a&&("pending"===b.status||"sending"===b.status))}getAllPending(){return this.ensureInitialized(),this.queue.filter(a=>"pending"===a.status||"sending"===a.status)}updateStatus(a,b){this.ensureInitialized();let c=this.queue.find(b=>b.id===a);c&&(c.status=b,this.saveToStorage())}markAsSent(a){this.ensureInitialized(),this.queue=this.queue.filter(b=>b.id!==a),this.saveToStorage()}markAsFailed(a){this.ensureInitialized();let b=this.queue.find(b=>b.id===a);b&&(b.retryCount++,b.status=b.retryCount>=this.MAX_RETRIES?"failed":"pending",this.saveToStorage())}cleanup(){this.ensureInitialized();let a=Date.now()-864e5;this.queue=this.queue.filter(b=>!("failed"===b.status&&b.timestamp<a)),this.saveToStorage()}clearRoom(a){this.ensureInitialized(),this.queue=this.queue.filter(b=>b.roomId!==a),this.saveToStorage()}saveToStorage(){}loadFromStorage(){}}let h=new g;class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}startHealthCheck(a){this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.healthCheckInterval=setInterval(()=>{a&&a.connected?(this.lastPingTime=Date.now(),a.emit("ping",this.lastPingTime),this.connectionStatus="connected"):(this.connectionStatus="disconnected",console.warn("Chat connection lost, attempting reconnect..."))},3e4)}stopHealthCheck(){this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null)}getConnectionStatus(){return{status:this.connectionStatus,lastPing:this.lastPingTime,isHealthy:"connected"===this.connectionStatus&&Date.now()-this.lastPingTime<6e4}}constructor(){this.healthCheckInterval=null,this.lastPingTime=0,this.connectionStatus="disconnected"}}let j=i.getInstance();class k{connect(){if(this.socket?.connected)return this.socket;let a=(0,e.getAuthToken)();if(!a)return console.warn("No auth token found, cannot connect to chat"),null;try{let b={auth:{token:a},transports:["polling","websocket"],timeout:3e4,forceNew:!1,withCredentials:!0,upgrade:!0,rememberUpgrade:!1,autoConnect:!0,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,reconnectionDelayMax:5e3};return b.secure=!0,b.rejectUnauthorized=!1,b.transports=["polling"],this.socket=(0,d.io)(f.f,b),this.socket.on("connect",()=>{console.log("✅ Chat connected to:",f.f),this.reconnectAttempts=0,this.processQueuedMessages(),setTimeout(()=>{this.socket?.connected&&j.startHealthCheck(this.socket)},2e3)}),this.socket.on("pong",a=>{if("number"==typeof a&&a>0){let b=Date.now()-a;b<1e4&&console.log(`Chat server latency: ${b}ms`)}}),this.socket.on("message_delivered",a=>{let b=this.messageCallbacks.get(a.messageId);b&&(b("sent"),this.messageCallbacks.delete(a.messageId)),h.markAsSent(a.messageId)}),this.socket.on("message_failed",a=>{let b=this.messageCallbacks.get(a.messageId);b&&(b("failed"),this.messageCallbacks.delete(a.messageId)),h.markAsFailed(a.messageId)}),this.socket.on("disconnect",a=>{console.log("Disconnected from chat server:",a),j.stopHealthCheck()}),this.socket.on("connect_error",a=>{console.error("Chat connection error:",a),this.handleReconnect()}),this.socket}catch(a){return console.error("Failed to create socket connection:",a),null}}handleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,setTimeout(()=>{console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),this.connect()},1e3*this.reconnectAttempts))}disconnect(){this.socket&&(j.stopHealthCheck(),this.socket.disconnect(),this.socket=null)}getHealthStatus(){return j.getConnectionStatus()}getSocket(){return this.socket}isConnected(){return this.socket?.connected||!1}sendMessage(a,b,c="text",d){let e=h.addMessage(a,b,c);return d&&this.messageCallbacks.set(e,d),this.isConnected()&&this.sendQueuedMessage({id:e,roomId:a,content:b,type:c,timestamp:Date.now(),status:"pending",retryCount:0}),e}async processQueuedMessages(){if(this.processingQueue||!this.isConnected())return;this.processingQueue=!0;let a=h.getAllPending();for(let b of(a.length>0&&console.log(`Processing ${a.length} queued messages`),a))try{await this.sendQueuedMessage(b),await new Promise(a=>setTimeout(a,200))}catch(a){console.error("Failed to send queued message:",a),h.markAsFailed(b.id)}this.processingQueue=!1,a.length>0&&console.log("Finished processing queued messages")}sendQueuedMessage(a){return new Promise((b,c)=>{if(!this.socket||!this.isConnected())return void c(Error("Socket not connected"));if(Date.now()-a.timestamp>864e5){console.log("Skipping old message:",a.id),h.markAsFailed(a.id),b();return}h.updateStatus(a.id,"sending");let d=setTimeout(()=>{h.markAsFailed(a.id),c(Error("Message send timeout"))},1e4),e=c=>{c.messageId===a.id&&(clearTimeout(d),this.socket?.off("message_delivered",e),this.socket?.off("message_failed",f),b())},f=b=>{b.messageId===a.id&&(clearTimeout(d),this.socket?.off("message_delivered",e),this.socket?.off("message_failed",f),c(Error("Message send failed")))};this.socket.on("message_delivered",e),this.socket.on("message_failed",f),this.socket.emit("send_message",{messageId:a.id,roomId:a.roomId,content:a.content,type:a.type})})}getPendingMessages(a){return h.getPendingMessages(a)}clearMessageQueue(a){h.clearRoom(a)}constructor(){this.socket=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.messageCallbacks=new Map,this.processingQueue=!1}}let l=new k},45119:(a,b,c)=>{"use strict";c.d(b,{BT:()=>j,Wu:()=>k,ZB:()=>i,Zp:()=>g,aR:()=>h});var d=c(21124),e=c(38301),f=c(15514);let g=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...b}));g.displayName="Card";let h=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex flex-col space-y-1.5 p-6",a),...b}));h.displayName="CardHeader";let i=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));i.displayName="CardTitle";let j=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("text-sm text-muted-foreground",a),...b}));j.displayName="CardDescription";let k=e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("p-6 pt-0",a),...b}));k.displayName="CardContent",e.forwardRef(({className:a,...b},c)=>(0,d.jsx)("div",{ref:c,className:(0,f.cn)("flex items-center p-6 pt-0",a),...b})).displayName="CardFooter"},47990:()=>{},50849:(a,b,c)=>{"use strict";function d(){return null}function e(a){}function f(){return null}function g(a){}async function h(a){try{return(await fetch("https://lost-found-79xn.onrender.com/api/auth/validate",{method:"GET",headers:{Authorization:`Bearer ${a}`}})).ok}catch{return!1}}function i(){return!!d()}function j(){window.location.href="/"}c.d(b,{gL:()=>f,getAuthToken:()=>d,isAuthenticated:()=>i,logout:()=>j,setAuthToken:()=>e,setUserData:()=>g,validateToken:()=>h}),process.env.NEXT_PUBLIC_AUTH_TOKEN_KEY,process.env.NEXT_PUBLIC_USER_DATA_KEY},58475:(a,b,c)=>{"use strict";c.d(b,{E$:()=>d,tk:()=>g});let d=(0,c(18610).vt)((a,b)=>({notifications:[],unreadCount:0,addNotification:b=>{let c={...b,id:Date.now().toString(),read:!1,createdAt:new Date};a(a=>({notifications:[c,...a.notifications],unreadCount:a.unreadCount+1}))},markAsRead:b=>{a(a=>({notifications:a.notifications.map(a=>a.id===b?{...a,read:!0}:a),unreadCount:Math.max(0,a.unreadCount-1)}))},markAllAsRead:()=>{a(a=>({notifications:a.notifications.map(a=>({...a,read:!0})),unreadCount:0}))},removeNotification:b=>{a(a=>{let c=a.notifications.find(a=>a.id===b);return{notifications:a.notifications.filter(a=>a.id!==b),unreadCount:c&&!c.read?Math.max(0,a.unreadCount-1):a.unreadCount}})},clearAll:()=>{a({notifications:[],unreadCount:0})}})),e={newMessage:(a,b,c)=>{d.getState().addNotification({type:"message",title:"\uD83D\uDCAC New Message",message:`${a} sent you a message about "${b}"`,itemId:c,itemTitle:b})}};class f{initialize(){}showChatNotification(a,b,c,d){e.newMessage(a,d,c)}}let g=new f},60637:(a,b,c)=>{"use strict";c.d(b,{f:()=>d});let d="https://lost-found-79xn.onrender.com"},63976:(a,b,c)=>{Promise.resolve().then(c.bind(c,87844)),Promise.resolve().then(c.bind(c,6554))},72966:(a,b,c)=>{"use strict";c.d(b,{F:()=>h});var d=c(21124),e=c(38301),f=c(84550),g=c(15514);let h=e.forwardRef(({className:a,children:b,...c},e)=>(0,d.jsxs)(f.bL,{ref:e,className:(0,g.cn)("relative overflow-hidden",a),...c,children:[(0,d.jsx)(f.LM,{className:"h-full w-full rounded-[inherit]",children:b}),(0,d.jsx)(i,{}),(0,d.jsx)(f.OK,{})]}));h.displayName=f.bL.displayName;let i=e.forwardRef(({className:a,orientation:b="vertical",...c},e)=>(0,d.jsx)(f.VM,{ref:e,orientation:b,className:(0,g.cn)("flex touch-none select-none transition-colors","vertical"===b&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===b&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...c,children:(0,d.jsx)(f.lr,{className:"relative flex-1 rounded-full bg-border"})}));i.displayName=f.VM.displayName},77128:(a,b,c)=>{Promise.resolve().then(c.bind(c,96850)),Promise.resolve().then(c.bind(c,86605))},78335:()=>{},82704:()=>{},86605:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/varma/projects/lost-found/frontend/components/presence-provider.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/varma/projects/lost-found/frontend/components/presence-provider.tsx","default")},87844:(a,b,c)=>{"use strict";c.d(b,{default:()=>B});var d=c(21124),e=c(38301),f=c(58620),g=c(81296),h=c(71179),i=c(47268),j=c(40280),k=c(88386),l=c(78660),m=c(47089),n=c(18310),o=c(65893),p=c(19217),q=c(45119),r=c(22544),s=c(36736),t=c(26519),u=c(50849),v=c(66013),w=c(60637);class x{connect(){return new Promise(a=>{if(this.socket?.connected)return void a(this.socket);let b=(0,u.getAuthToken)();if(!b){this.updateConnectionState({status:"error",error:"No authentication token"}),a(null);return}this.updateConnectionState({status:"connecting"});try{this.socket=(0,v.io)(w.f,{auth:{token:b},transports:["websocket","polling"],timeout:1e4,forceNew:!0,withCredentials:!0,autoConnect:!0,reconnection:!1}),this.setupEventListeners(),a(this.socket)}catch(b){this.updateConnectionState({status:"error",error:b instanceof Error?b.message:"Connection failed"}),a(null)}})}setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{this.updateConnectionState({status:"connected",lastConnected:Date.now(),retryCount:0,error:void 0}),this.processMessageQueue(),this.startHealthCheck(),this.emit("connection_restored")}),this.socket.on("disconnect",a=>{this.updateConnectionState({status:"disconnected"}),this.stopHealthCheck(),this.emit("connection_lost",a),"io client disconnect"!==a&&this.scheduleReconnect()}),this.socket.on("connect_error",a=>{this.updateConnectionState({status:"error",error:a.message,retryCount:this.connectionState.retryCount+1}),this.emit("connection_error",a),this.scheduleReconnect()}),this.socket.on("pong",()=>{}))}scheduleReconnect(){if(this.connectionState.retryCount>=this.maxRetries)return void this.updateConnectionState({status:"error",error:"Max retries exceeded"});this.reconnectTimer&&clearTimeout(this.reconnectTimer);let a=Math.min(this.baseDelay*Math.pow(2,this.connectionState.retryCount),3e4);this.updateConnectionState({status:"reconnecting"}),this.reconnectTimer=setTimeout(()=>{this.connect()},a)}startHealthCheck(){this.healthCheckTimer&&clearInterval(this.healthCheckTimer),this.healthCheckTimer=setInterval(()=>{this.socket?.connected&&this.socket.emit("ping")},3e4)}stopHealthCheck(){this.healthCheckTimer&&(clearInterval(this.healthCheckTimer),this.healthCheckTimer=void 0)}sendMessage(a,b,c="text"){let d=`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,e={id:d,roomId:a,content:b,type:c,timestamp:Date.now(),status:"pending",retryCount:0};return this.messageQueue.push(e),this.isConnected()&&this.sendQueuedMessage(e),d}async sendQueuedMessage(a){if(this.socket?.connected){a.status="sending";try{await new Promise((b,c)=>{let d=setTimeout(()=>c(Error("Send timeout")),1e4);this.socket.emit("send_message",{messageId:a.id,roomId:a.roomId,content:a.content,type:a.type},e=>{clearTimeout(d),e.success?(a.status="sent",b()):c(Error(e.error||"Send failed"))})})}catch(b){a.status="failed",a.retryCount++,a.retryCount<3&&setTimeout(()=>this.sendQueuedMessage(a),5e3)}}}processMessageQueue(){this.messageQueue.filter(a=>"pending"===a.status||"failed"===a.status).forEach(a=>{a.retryCount<3&&this.sendQueuedMessage(a)})}on(a,b){this.listeners.has(a)||this.listeners.set(a,[]),this.listeners.get(a).push(b),this.socket&&!["connection_restored","connection_lost","connection_error"].includes(a)&&this.socket.on(a,b)}off(a,b){if(b){let c=this.listeners.get(a)||[],d=c.indexOf(b);d>-1&&c.splice(d,1)}else this.listeners.delete(a);this.socket&&this.socket.off(a,b)}emit(a,...b){(this.listeners.get(a)||[]).forEach(a=>a(...b))}updateConnectionState(a){this.connectionState={...this.connectionState,...a},this.emit("connection_state_changed",this.connectionState)}getConnectionState(){return{...this.connectionState}}isConnected(){return this.socket?.connected||!1}getSocket(){return this.socket}getPendingMessages(a){return this.messageQueue.filter(b=>("pending"===b.status||"failed"===b.status)&&(!a||b.roomId===a))}disconnect(){this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.healthCheckTimer&&clearInterval(this.healthCheckTimer),this.socket&&(this.socket.disconnect(),this.socket=null),this.updateConnectionState({status:"disconnected"})}joinRoom(a){this.socket?.connected&&this.socket.emit("join_room",a)}leaveRoom(a){this.socket?.connected&&this.socket.emit("leave_room",a)}markMessagesRead(a){this.socket?.connected&&this.socket.emit("mark_read",{messageIds:a})}constructor(){this.socket=null,this.connectionState={status:"disconnected",retryCount:0},this.messageQueue=[],this.listeners=new Map,this.maxRetries=5,this.baseDelay=1e3}}let y=new x;var z=c(23167),A=c(95907);function B(){let[a,b]=(0,e.useState)(!1),[c,u]=(0,e.useState)(!1),[v,x]=(0,e.useState)(!1),[B,C]=(0,e.useState)(null),[D,E]=(0,e.useState)(!1),[F,G]=(0,e.useState)(""),[H,I]=(0,e.useState)(!1),[J,K]=(0,e.useState)(0),[L,M]=(0,e.useState)({status:"disconnected",retryCount:0}),[N,O]=(0,e.useState)(!1),[P,Q]=(0,e.useState)(null),[R,S]=(0,e.useState)(!1),[T,U]=(0,e.useState)(!1);(0,e.useRef)(!1);let V=(0,e.useCallback)(async()=>{if(!R){S(!0),Q(null);try{await y.connect(),await W(),await Y()}catch(a){Q("Failed to initialize chat system"),console.error("Chat initialization error:",a)}finally{S(!1)}}},[R]),W=(0,e.useCallback)(async()=>{if(D)try{let a=await fetch(`${w.f}/api/chat/rooms`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(a.ok){let b=await a.json();I(b.length>0);let c=b.reduce((a,b)=>a+(b.unreadCount||0),0);K(c)}}catch(a){console.error("Failed to load chat rooms:",a)}},[D]);(0,e.useCallback)(a=>{a.senderId!==F&&(K(a=>a+1),X(a))},[F]);let X=(0,e.useCallback)(a=>{if(N&&"visible"!==document.visibilityState&&"Notification"in window&&"granted"===Notification.permission){let c=new Notification("New Message",{body:a.content,icon:"/favicon.ico",tag:"chat-message",requireInteraction:!1});c.onclick=()=>{window.focus(),b(!0),c.close()},setTimeout(()=>c.close(),5e3)}},[N]),Y=(0,e.useCallback)(async()=>{"Notification"in window&&O("granted"===await Notification.requestPermission())},[]),Z=(0,e.useCallback)(a=>{C(a),K(b=>Math.max(0,b-(a.unreadCount||0)))},[]),$=(0,e.useCallback)(()=>{C(null)},[]),_=(0,e.useCallback)(()=>{Q(null),V()},[V]);return D||H?(0,d.jsxs)(s.Bc,{children:[!a&&(0,d.jsxs)(s.m_,{children:[(0,d.jsx)(s.k$,{asChild:!0,children:(0,d.jsx)(p.$,{onClick:()=>{if(!D){window.location.href="/login";return}b(!0),y.isConnected()||V()},className:`fixed bottom-6 right-6 w-14 h-14 rounded-full shadow-lg z-50 p-0 transition-all duration-300 ${"connected"===L.status?"bg-blue-600 hover:bg-blue-700":"bg-gray-500 hover:bg-gray-600"}`,"aria-label":"Open chat",children:(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(h.A,{className:"w-6 h-6 text-white"}),J>0&&(0,d.jsx)(r.E,{className:"absolute -top-2 -right-2 w-5 h-5 p-0 flex items-center justify-center bg-red-500 text-white text-xs","aria-label":`${J} unread messages`,children:J>99?"99+":J}),"connected"!==L.status&&(0,d.jsx)("div",{className:"absolute -bottom-1 -right-1 w-3 h-3 bg-white rounded-full flex items-center justify-center",children:(0,d.jsx)(g.A,{className:"w-2 h-2 text-red-500"})})]})})}),(0,d.jsx)(s.ZI,{side:"left",children:(0,d.jsx)("p",{children:D?"connected"===L.status?"Open messages":"Chat offline - Click to retry":"Login to chat"})})]}),a&&(0,d.jsx)("div",{className:`fixed bottom-6 right-6 z-50 transition-all duration-300 ${v?"w-96 h-[600px] md:w-[500px] md:h-[700px]":c?"w-80 h-12":"w-80 h-96 md:w-96 md:h-[500px]"}`,children:(0,d.jsxs)(q.Zp,{className:"h-full shadow-xl border-2 flex flex-col",children:[(0,d.jsx)(q.aR,{className:"p-3 bg-blue-600 text-white rounded-t-lg flex-shrink-0",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,d.jsx)(q.ZB,{className:"text-sm font-medium truncate",children:B?B.itemId.title:"Messages"}),(0,d.jsxs)(s.m_,{children:[(0,d.jsx)(s.k$,{asChild:!0,children:(0,d.jsx)("div",{className:"flex items-center",children:(()=>{switch(L.status){case"connected":return(0,d.jsx)(f.A,{className:"w-3 h-3 text-green-400"});case"connecting":case"reconnecting":return(0,d.jsx)("div",{className:"w-3 h-3 border border-yellow-400 border-t-transparent rounded-full animate-spin"});default:return(0,d.jsx)(g.A,{className:"w-3 h-3 text-red-400"})}})()})}),(0,d.jsx)(s.ZI,{children:(0,d.jsx)("p",{children:"connected"===L.status?"Connected":"connecting"===L.status?"Connecting...":"reconnecting"===L.status?"Reconnecting...":"Disconnected"})})]}),D&&(0,d.jsxs)(s.m_,{children:[(0,d.jsx)(s.k$,{asChild:!0,children:(0,d.jsx)(p.$,{variant:"ghost",size:"sm",onClick:()=>O(!N),className:"text-white hover:bg-blue-700 p-1 h-5 w-5",children:N?(0,d.jsx)(i.A,{className:"w-3 h-3"}):(0,d.jsx)(j.A,{className:"w-3 h-3"})})}),(0,d.jsx)(s.ZI,{children:(0,d.jsx)("p",{children:N?"Disable notifications":"Enable notifications"})})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,d.jsx)(p.$,{variant:"ghost",size:"sm",onClick:()=>x(!v),className:"text-white hover:bg-blue-700 p-1 h-6 w-6",children:v?(0,d.jsx)(k.A,{className:"w-3 h-3"}):(0,d.jsx)(l.A,{className:"w-3 h-3"})}),(0,d.jsx)(p.$,{variant:"ghost",size:"sm",onClick:()=>u(!c),className:"text-white hover:bg-blue-700 p-1 h-6 w-6",children:(0,d.jsx)(k.A,{className:"w-3 h-3"})}),(0,d.jsx)(p.$,{variant:"ghost",size:"sm",onClick:()=>{b(!1),C(null),u(!1),x(!1)},className:"text-white hover:bg-blue-700 p-1 h-6 w-6",children:(0,d.jsx)(m.A,{className:"w-3 h-3"})})]})]})}),(P||T)&&!c&&(0,d.jsxs)(t.Fc,{className:"m-2 border-red-200 bg-red-50",children:[(0,d.jsx)(n.A,{className:"h-4 w-4 text-red-600"}),(0,d.jsxs)(t.TN,{className:"text-red-800 text-sm",children:[P||"You are offline. Messages will be sent when connection is restored.","error"===L.status&&(0,d.jsx)(p.$,{variant:"link",size:"sm",onClick:_,className:"ml-2 p-0 h-auto text-red-600 underline",children:"Retry"})]})]}),!c&&(0,d.jsx)(q.Wu,{className:"p-0 flex-1 overflow-hidden",children:D?R?(0,d.jsxs)("div",{className:"p-4 text-center",children:[(0,d.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:"Initializing chat..."})]}):B?(0,d.jsx)(A.A,{room:B,currentUserId:F,onBack:$}):(0,d.jsx)(z.A,{onSelectRoom:Z,currentUserId:F}):(0,d.jsxs)("div",{className:"p-4 text-center",children:[(0,d.jsx)(o.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,d.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Login Required"}),(0,d.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Please login to start chatting with other users"}),(0,d.jsx)(p.$,{onClick:()=>window.location.href="/login",className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Login"})]})})]})})]}):null}},90391:(a,b,c)=>{"use strict";function d(){return null}c.r(b),c.d(b,{default:()=>d})},95907:(a,b,c)=>{"use strict";c.d(b,{A:()=>s});var d=c(21124),e=c(38301),f=c(45119),g=c(19217),h=c(7629),i=c(72966),j=c(22544),k=c(674),l=c(79944),m=c(56955),n=c(47089),o=c(71563),p=c(43567),q=c(60637),r=c(50849);function s({room:a,onClose:b,onBack:c,currentUserId:s}){let[t,u]=(0,e.useState)([]),[v,w]=(0,e.useState)([]),[x,y]=(0,e.useState)(""),[z,A]=(0,e.useState)(!0),[B,C]=(0,e.useState)(!1),[D,E]=(0,e.useState)(navigator.onLine),F=(0,e.useRef)(null),G=p.b.getSocket(),H=a.participants.find(a=>a.userId._id!==s),I=async()=>{if(!x.trim()||B)return;C(!0);let b=x.trim();y("");try{if(G&&G.connected){let c={id:p.b.sendMessage(a._id,b,"text",b=>{"failed"===b&&w(p.b.getPendingMessages(a._id))}),roomId:a._id,content:b,type:"text",timestamp:Date.now(),status:"pending",retryCount:0};w(a=>[...a,c])}else{let c=(0,r.getAuthToken)(),d=await fetch(`${q.f}/api/chat/room/${a._id}/message`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({content:b,type:"text"})});if(d.ok){let a=await d.json();u(b=>[...b,a])}else throw Error("Failed to send message via HTTP")}}catch(a){console.error("Failed to send message:",a),y(b),alert("Failed to send message. Please try again.")}finally{C(!1)}},J=async()=>{if(H)try{let a=(0,r.getAuthToken)();(await fetch(`${q.f}/api/chat/block/${H.userId._id}`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:JSON.stringify({reason:"Blocked from chat"})})).ok&&(alert("User blocked successfully"),b?.())}catch(a){console.error("Block user error:",a)}},K=a=>a.readBy?.some(a=>a.userId!==s)||!1;return(0,d.jsxs)(f.Zp,{className:"h-full flex flex-col",children:[(0,d.jsx)(f.aR,{className:"pb-3 border-b",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(g.$,{variant:"ghost",size:"sm",onClick:c||b,children:(0,d.jsx)(l.A,{className:"w-4 h-4"})}),a.itemId.imageUrl&&(0,d.jsx)("img",{src:a.itemId.imageUrl,alt:a.itemId.title,className:"w-10 h-10 rounded-lg object-cover"}),(0,d.jsxs)("div",{children:[(0,d.jsx)(f.ZB,{className:"text-lg",children:a.itemId.title}),(0,d.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,d.jsx)(j.E,{variant:"outline",children:a.itemId.category}),(0,d.jsx)("span",{children:"•"}),(0,d.jsxs)("span",{children:["with ",H?.userId.name]})]})]})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(g.$,{variant:"ghost",size:"sm",onClick:J,title:"Block User",children:(0,d.jsx)(m.A,{className:"w-4 h-4"})}),b&&(0,d.jsx)(g.$,{variant:"ghost",size:"sm",onClick:b,children:(0,d.jsx)(n.A,{className:"w-4 h-4"})})]})]})}),(0,d.jsxs)(f.Wu,{className:"flex-1 p-0",children:[(0,d.jsx)(i.F,{className:"h-96 p-4",children:z?(0,d.jsx)("div",{className:"flex justify-center py-8",children:(0,d.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})}):(0,d.jsxs)("div",{className:"space-y-4",children:[t.map(a=>{let b=a.senderId._id===s;return(0,d.jsx)("div",{className:`flex ${b?"justify-end":"justify-start"}`,children:(0,d.jsxs)("div",{className:`flex items-start gap-2 max-w-[70%] ${b?"flex-row-reverse":""}`,children:[!b&&(0,d.jsx)(k.eu,{className:"w-8 h-8",children:(0,d.jsx)(k.q5,{className:"text-xs",children:a.senderId.name.charAt(0)})}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:`rounded-lg px-3 py-2 ${b?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"}`,children:[(0,d.jsx)("p",{className:"text-sm",children:a.content}),(0,d.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,d.jsx)("p",{className:`text-xs ${b?"text-blue-100":"text-gray-500"}`,children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),b&&(0,d.jsx)("span",{className:`text-xs ${K(a)?"text-blue-200":"text-blue-300"}`,children:K(a)?"✓✓":"✓"})]})]}),a.reactions&&a.reactions.length>0&&(0,d.jsx)("div",{className:"flex gap-1 mt-1",children:a.reactions.map((a,b)=>(0,d.jsx)("span",{className:"text-xs bg-gray-100 px-1 rounded",children:a.emoji},b))})]})]})},a._id)}),v.map(a=>(0,d.jsx)("div",{className:"flex justify-end",children:(0,d.jsx)("div",{className:"flex items-start gap-2 max-w-[70%] flex-row-reverse",children:(0,d.jsxs)("div",{className:"bg-blue-400 text-white rounded-lg px-3 py-2 opacity-70",children:[(0,d.jsx)("p",{className:"text-sm",children:a.content}),(0,d.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,d.jsx)("p",{className:"text-xs text-blue-100",children:new Date(a.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),(0,d.jsxs)("span",{className:"text-xs text-blue-200",children:["pending"===a.status&&"⏳","sending"===a.status&&"\uD83D\uDCE4","failed"===a.status&&"❌"]})]})]})})},a.id)),(0,d.jsx)("div",{ref:F})]})}),(0,d.jsxs)("div",{className:"border-t p-4",children:[!D&&(0,d.jsx)("div",{className:"mb-2 p-2 bg-yellow-50 border border-yellow-200 rounded text-sm text-yellow-800",children:"\uD83D\uDCE1 You're offline. Messages will be sent when connection is restored."}),(0,d.jsxs)("div",{className:"flex gap-2",children:[(0,d.jsx)(h.p,{placeholder:D?"Type a message...":"Type a message (will send when online)...",value:x,onChange:a=>y(a.target.value),onKeyPress:a=>"Enter"===a.key&&I(),disabled:B,className:"flex-1"}),(0,d.jsx)(g.$,{onClick:I,disabled:!x.trim()||B,size:"sm",children:B?(0,d.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):(0,d.jsx)(o.A,{className:"w-4 h-4"})})]})]})]})]})}c(58475)},96487:()=>{},96850:(a,b,c)=>{"use strict";c.d(b,{default:()=>d});let d=(0,c(97954).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/home/varma/projects/lost-found/frontend/components/improved-floating-chat.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/home/varma/projects/lost-found/frontend/components/improved-floating-chat.tsx","default")}};